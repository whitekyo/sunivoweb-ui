!function(a,b){var d=/^([\u4E00-\u9FA5\uf900-\ufa2d]+)\|([^\|]+)\|([^\|]+)/i,e=/([\u4E00-\u9FA5\uf900-\ufa2d]+)/,i={A:/^[a]$/i,B:/^[b]$/i,C:/^[c]$/i,DEF:/^[d-f]$/i,GHI:/^[g-i]$/i,JKL:/^[j-l]$/i,M:/^[m]$/i,NO:/^[n-o]$/i,PQR:/^[p-r]$/i,S:/^[s]$/i,TU:/^[t-u]$/i,VWX:/^[v-x]$/i,YZ:/^[y-z]$/i},j=['<p class="tip">Query Ports</p>',"<ul>",'<li class="on">Nearby Ports</li>',"<li>A</li>","<li>B</li>","<li>C</li>","<li>DEF</li>","<li>GHI</li>","<li>JKL</li>","<li>M</li>","<li>NO</li>","<li>PQR</li>","<li>S</li>","<li>TU</li>","<li>VWX</li>","<li>YZ</li>","</ul>"],k=function(){this.initialize.apply(this,arguments)};k.defaults={reg:i,regEx:d,regExChinese:e,template:j},k.prototype={constructor:k,initialize:function(c,d){this.options=d,this.input=a(c),this.rootDiv=a("<div class='citySelector' style='position:absolute;z-index:900;'></div>");var e=document.all?!0:!1,f=this.isIE6=e&&!b.XMLHttpRequest;f&&(this.myIframe=a("<iframe src='about:blank' style='position: absolute;z-index: -1' frameBorder=0></iframe>"),this.rootDiv.append(this.myIframe)),this.prepareInput(),this.inputEvent()},remove:function(){this.myIframe&&this.myIframe.remove(),null!=this.cityBox&&this.cityBox.remove(),this.cityBox=null,this.rootDiv.remove()},doClean:function(){var b=a(".citySelector");b.find(".cityBox").addClass("hide"),b.find("ul.cityslide").addClass("hide"),b.find("iframe").addClass("hide")},prepareInput:function(){this.input.attr("autocomplete","off"),this.hidden=a("<input type='hidden'>").insertAfter(this.input),this.hiddenType=a("<input type='hidden'>").insertAfter(this.input),this.hidden.attr("name",this.input.attr("name")+"portcode"),this.hiddenType.attr("name",this.input.attr("name")+"_type");var b=this.input.data("portId");if(b){var c=this.findPortById(b);c&&(this.hidden.val(c.id),this.hiddenType.val(c.type),"domesticSeaPort"==c.type||"domesticAirPort"==c.type?this.input.data("region","domestic"):this.input.data("region","foreign"))}},getPos:function(b){var c=document.documentElement.scrollLeft||document.body.scrollLeft,d=document.documentElement.scrollTop||document.body.scrollTop,e=a(b).position();return{top:e.top+d,right:e.right+c,bottom:e.top+a(b).outerHeight()+d,left:e.left+c}},createWarp:function(){this.getPos(this.input),this.rootDiv;var e=this;this.rootDiv.on("click",function(a){return a.stopPropagation(),!1}),a(b.document).on("click",function(b){return b==e.input?!1:(e.cityBox&&a(e.cityBox).addClass("hide"),e.ul&&a(e.ul).addClass("hide"),e.myIframe&&a(e.myIframe).addClass("hide"),void 0)}),this.cityBox=a("<div class='cityBox'>"+j.join("")+"</div>"),this.hotCity=a("<div class='hotCity'></div>"),this.cityBox.append(this.hotCity),this.rootDiv.append(this.cityBox),this.createHotCity()},createHotCity:function(){var b,c,d,e,g,h,i,j,f=[],l=this.parseOCity();for(h in l){if(b=this[h]=document.createElement("div"),b.className=h+" "+"cityTab hide",this.hotCity.append(b),j=[],"hot"!=h){for(i in l[h])j.push(i),j.sort();for(var m=0,n=j.length;n>m;m++){c=document.createElement("dl"),d=document.createElement("dt"),e=document.createElement("dd"),d.innerHTML="hot"==j[m]?"&nbsp;":j[m],f=[];for(var o=0,p=l[h][j[m]].length;p>o;o++){var q=l[h][j[m]][o].type,r=this.options.cn?l[h][j[m]][o].cnName:l[h][j[m]][o].enName;g='<a href="javascript:" data-port-id="'+l[h][j[m]][o].id+'" data-port-type="'+q+'">'+r+"</a>",f.push(g)}e.innerHTML=f.join(""),c.appendChild(d),c.appendChild(e),b.appendChild(c)}}else{var s=l.hot;if(s.length>0){c=document.createElement("dl"),d=document.createElement("dt"),e=document.createElement("dd"),f=[];for(var m=0,n=l.hot.length;n>m;m++){var t=l.hot[m],r=this.options.cn?t.cnName:t.enName;g='<a href="javascript:" data-port-id="'+t.id+'" data-port-type="'+t.type+'">'+r+"</a>",f.push(g)}e.innerHTML=f.join(""),c.appendChild(d),c.appendChild(e),b.appendChild(c)}else this.cityBox.find("ul li:first-child").remove(),this.cityBox.find("ul li:first-child").addClass("on"),this.hotCity.find(".cityTab.hot").remove()}this.hotCity.find(".cityTab:first").removeClass("hide")}a(document.body).append(this.rootDiv),this.rootDiv.position({of:this.input,at:"left bottom",my:"left top",collision:"none none"}),this.changeIframe(),this.tabChange(),this.linkEvent()},isForeignPort:function(a){return"foreignAirPort"==a||"foreignSeaPort"==a},parsePorts:function(){var a=[],b=this.input.data("sea"),c=this.input.data("region");if(1==b)switch(c){case"domestic":a=Ports.domesticSeaPorts;break;case"foreign":a=Ports.foreignSeaPorts;break;case"all":a=Ports.domesticSeaPorts.concat(Ports.foreignSeaPorts);break;default:a=[]}else switch(c){case"domestic":a=Ports.domesticAirPorts;break;case"foreign":a=Ports.foreignAirPorts;break;case"all":a=Ports.domesticAirPorts.concat(Ports.foreignAirPorts);break;default:a=[]}return a},parseOCity:function(){var a=[],b=this.input.data("sea"),c=this.input.data("region");if(1==b)switch(c){case"domestic":a=this.options.dSeaPorts;break;case"foreign":a=this.options.fSeaPorts;break;case"all":a=this.options.seaPorts;break;default:a=[]}else switch(c){case"domestic":a=this.options.dAirPorts;break;case"foreign":a=this.options.fAirPorts;break;case"all":a=this.options.airPorts;break;default:a=[]}return a},tabChange:function(){for(var b=a("li",this.cityBox),c=a("div",this.hotCity),d=this,e=0,f=b.length;f>e;e++)b[e].index=e,b[e].onclick=function(){for(var e=0;f>e;e++)a(b[e]).removeClass("on"),a(c[e]).addClass("hide");a(this).addClass("on"),a(c[this.index]).removeClass("hide"),d.changeIframe()}},linkEvent:function(){var b=this;a(this.hotCity).on("click","a",function(){var c=a(this);b.input.val(c.html()),b.hidden.val(c.data("port-id")),b.hiddenType.val(c.data("port-type")),b.hiddenType.trigger("change"),a(b.cityBox).addClass("hide"),a(b.myIframe).addClass("hide")})},_findPort:function(a,b){return b(a)?a:null},criteria:function(a,b){var c=new RegExp("^"+b+"|\\|"+b,"gi");return function(){return c.test(a.enName)||c.test(a.shortName)||c.test(a.cnName)||b==a.countryCn||b==a.countryEn||b==a.countryShort}},__findPort:function(a,b){var c,d,e,f;for(d=0,e=a.length;e>d&&(c=a[d],!(f=this._findPort(c,this.criteria(c,b))));d++);return f},findPort:function(){var b=null,c=a.trim(this.input.val()),d=this.parsePorts();return c&&(b=this.__findPort(d,c)),b},findPortById:function(a){for(var c in b.Ports)for(var d=Ports[c],e=0,f=d.length;f>e;e++){var g=d[e];if(g.id==a)return g}return null},inputEvent:function(){var b=this;this.input.on("click",function(c){c.stopPropagation(),b.cityBox?b.cityBox&&b.cityBox.hasClass("hide")&&(!b.ul||b.ul&&a(b.ul).hasClass("hide"))&&(b.cityBox.removeClass("hide"),a(b.myIframe).removeClass("hide"),b.changeIframe()):b.createWarp()}),this.input.on("focus",function(){b.doClean(),b.input.trigger("click"),"\u57ce\u5e02\u540d"==b.input.value&&(b.input.value="")}),this.input.on("keyup",function(c){var d=c.keyCode;b.cityBox&&b.cityBox.addClass("hide"),40!=d&&38!=d&&13!=d&&b.createUl(),a(b.myIframe).removeClass("hide"),b.ul&&!a(b.ul).hasClass("hide")&&b.KeyboardEvent(c,d)})},createUl:function(){var b,c=a.trim(this.input.val()),d=this.parsePorts(),e=this.options.cn;if(""!==c){for(var f=new RegExp("^.*"+c+"|\\|"+c+".*","gi"),g=[],h=0,i=d.length;i>h;h++){var j=d[h],k=e?j.cnName:j.enName,l=e?j.countryCn:j.countryEn;(f.test(j.enName)||f.test(j.shortName)||f.test(j.cnName)||c==j.countryCn||c==j.countryEn||c==j.countryShort)&&(b=0!==g.length?'<li data-port-id="'+j.id+'" data-port-type="'+j.type+'"><b class="cityname">'+k+'</b><b class="cityspell">'+l+"</b></li>":'<li class="on" data-port-id="'+j.id+'" data-port-type="'+j.type+'"><b class="cityname">'+k+'</b><b class="cityspell">'+l+"</b></li>",g.push(b))}if(this.isEmpty=!1,0==g.length&&(this.isEmpty=!0,b='<li class="empty">No Result:  "<em>'+c+'</em>"</li>',g.push(b)),this.ul)this.ul&&a(this.ul).hasClass("hide")&&(this.count=0,a(this.ul).removeClass("hide"));else{var m=this.ul=document.createElement("ul");m.className="cityslide",this.rootDiv&&this.rootDiv.append(m),this.count=0}this.ul.innerHTML=g.join(""),this.changeIframe(),this.liEvent()}else a(this.ul).addClass("hide"),a(this.cityBox).removeClass("hide"),a(this.myIframe).removeClass("hide"),this.changeIframe()},changeIframe:function(){this.isIE6&&(this.myIframe.style.width=this.rootDiv.offsetWidth+"px",this.myIframe.style.height=this.rootDiv.offsetHeight+"px")},KeyboardEvent:function(b,c){var d=a("li",this.ul),e=d.length;switch(c){case 40:this.count++,this.count>e-1&&(this.count=0);for(var f=0;e>f;f++)a(d[f]).removeClass("on");a(d[this.count]).addClass("on");break;case 38:for(this.count--,this.count<0&&(this.count=e-1),f=0;e>f;f++)a(d[f]).removeClass("on");a(d[this.count]).addClass("on");break;case 13:b.preventDefault();var g=a("li.on",this.ul),h=g.find(".cityname").text();this.input.val(h),this.hidden.val(g.data("port-id")),this.hiddenType.val(g.data("port-type")),this.hiddenType.trigger("change"),a(this.ul).addClass("hide"),a(this.myIframe).addClass("hide")}},liEvent:function(){var b=this,d=(a("li",this.ul),"");a(this.ul).on("click","li",function(){d=a(this).find(".cityname").text(),b.input.val(d),b.hidden.val(a(this).data("port-id")),b.hiddenType.val(a(this).data("port-type")),a(b.ul).addClass("hide")}).on("mouseover","li",function(){a(this).addClass("on")}).on("mouseout","li",function(){a(this).removeClass("on")})}},b.PortSelector=k}(jQuery,window);